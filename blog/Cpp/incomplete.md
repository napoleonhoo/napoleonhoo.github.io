# Incomplete Type of C++

参考文章：[Understanding Incomplete Type in C++](https://www.lightly-dev.com/blog/cpp-incomplete-type-is-not-allowed/)

在C++中，不完整类型指的是一个类型被声明了，但是没有完全被定义。这意味着编译器遇到了这个类型的声明，但是没有足够的信息来确定它的size和成员。这种情况一般产生在它被声明了但是它的定义还没有，或者它声明的时候没有相关的信息。

不完整类型是C++中一个很重要的概念，因为编译器需要一个类型的完整的信息来进行多种操作，如分配内存、确定对象的大小、访问它的成员、或计算偏移。没有完整的信息，编译器就不能准确地执行这些操作。

## 造成不完整类型的常见情形

### Forward Declariations（前置声明）

举例：

``` cpp
class MyClass;

MyClass *obj;
```

在这个例子中，当编译器看到`obj`时，`MyClass`是不完整类型。

### 递归的数据结构

``` cpp
struct Node {
    int data;
    Node* next;
};
```

这里，当编译器看到`next`时，`Node`是个不完整类型。当`Node`的定义完全结束时，它才是完整的。

### 类继承

``` cpp
class Base;

class Derived : public Base {

};
```

因为`Base`类是一个不完整类型，`Derived`类也就不是一个完整类型。


## 不完整类型的限制


### 不能创建不完整类型的对象

因为不完整类型没有大小、结构等的信息，所以不可能在创建它的对象。因为创建对象时需要分配内存、初始化成员。

只可以声明指向不完整类型的指针或引用。

### 不能访问不完整类型的成员

因为不知道不完整类型的结构。

### 不能使用需要完整的类型信息的操作

包括计算类型的大小、指针算术、确定对齐（alignment）要求、使用依赖完整类型信息的语言特性。

比如：`sizeof` operator不能在不完整类型上使用。需要指针算术或特定的语言特性相关的内容，如虚函数、继承等。